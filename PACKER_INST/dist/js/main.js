function getURLParameter(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function run_geo(e){$.ajax({type:"GET",url:e,dataType:"xml",success:function(e){$(e).find("ip").each(function(){var e=$(this).find("city").text(),i=$(this).find("region").text();if(e!=i)var n=e+", "+i;else n=e;$('<input type="hidden" />').attr({name:"location",class:"location",value:n}).appendTo("form")})}})}function validateEmail(e){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)}$.get("http://ipinfo.io",function(e){geo_url="http://ipgeobase.ru:7020/geo?ip="+e.ip,run_geo(geo_url)},"jsonp"),utm=[],$.each(["utm_source","utm_medium","utm_campaign","utm_term","source_type","source","position_type","position","added","creative","matchtype"],function(e,i){$('<input type="hidden" />').attr({name:i,class:i,value:function(){return null==getURLParameter(i)?"-":getURLParameter(i)}}).appendTo("form")}),$('<input type="hidden" />').attr({name:"url",value:document.location.href}).appendTo("form"),$('<input type="hidden" />').attr({name:"title",value:document.title}).appendTo("form"),$(document).ready(function(){$(".map").append('<iframe src="ajax/map.html"></iframe>'),$('input[name="name"]').blur(function(){$(this).val().length<2&&$(this).addClass(" error-input ")}),$('input[name="name"]').focus(function(){$(this).removeClass(" error-input ")}),$('input[name="phone"]').mask("+7 (999) 999-99-99"),$('input[name="phone"]').blur(function(){18!=$(this).val().length&&$(this).addClass("error-input")}),$('input[name="phone"]').focus(function(){$(this).removeClass("error-input")}),$('input[name="email"]').blur(function(){validateEmail($(this).val())||$(this).addClass("error-input")}),$('input[name="email"]').focus(function(){$(this).removeClass("error-input")}),$(".zakaz,.start,.shema").click(function(){$(".pop_z").show("#okgo").arcticmodal()});$(".slider_1").bxSlider({infiniteLoop:!0,controls:!1,pager:!0,pagerCustom:"#slider_1_control",auto:!1,speed:500,minSlides:1,maxSlides:1,moveSlides:1}),$(".slider_2").bxSlider({infiniteLoop:!0,controls:!1,pager:!0,pagerCustom:"#slider_2_control",auto:!1,speed:500,minSlides:1,maxSlides:1,moveSlides:1}),$(".slider_3").bxSlider({infiniteLoop:!0,controls:!0,pager:!0,pagerCustom:"#slider_3_control",auto:!1,speed:500,minSlides:1,maxSlides:1,moveSlides:1});$(".fancy").fancybox({maxWidth:"90%",maxHeight:"90%",padding:0,helpers:{overlay:{locked:!1},title:null},afterShow:function(){$(".fancybox-wrap").swipe({swipe:function(e,i){"left"===i&&$.fancybox.prev(i),"right"===i&&$.fancybox.next(i)}})}}),$("form").submit(function(e){if(e.preventDefault(),$(this).find('input[type="text"]').trigger("blur"),$(this).find('input[type="text"]').hasClass("error-input")){var i="";!$(this).find('input[name="name"]').hasClass("error-input")||$(this).find('input[name="phone"]').hasClass("error-input")||$(this).find('input[name="email"]').hasClass("error-input")?!$(this).find('input[name="phone"]').hasClass("error-input")||$(this).find('input[name="name"]').hasClass("error-input")||$(this).find('input[name="email"]').hasClass("error-input")?$(this).find('input[name="phone"]').hasClass("error-input")&&$(this).find('input[name="name"]').hasClass("error-input")&&!$(this).find('input[name="email"]').hasClass("error-input")&&(i="Пожалуйста введите имя и телефон"):i="Пожалуйста введите телефон":i="Пожалуйста введите имя",$(this).find('input[name="name"]').hasClass("error-input")&&!$(this).find('input[name="phone"]').hasClass("error-input")&&$(this).find('input[name="email"]').hasClass("error-input")?i="Пожалуйста введите имя и email":$(this).find('input[name="phone"]').hasClass("error-input")&&!$(this).find('input[name="name"]').hasClass("error-input")&&$(this).find('input[name="email"]').hasClass("error-input")?i="Пожалуйста введите телефон и email":$(this).find('input[name="phone"]').hasClass("error-input")&&$(this).find('input[name="name"]').hasClass("error-input")&&$(this).find('input[name="email"]').hasClass("error-input")&&(i="Пожалуйста введите имя, email и телефон"),$("#form-error-text").html(i),$("#form-error-pop").arcticmodal()}else{var n=$(this).attr("method"),t=$(this).attr("action"),a=$(this).serialize();$(this).find('input[name="event"]').val();$.ajax({type:n,url:t,data:a,success:function(){$.arcticmodal("close"),$("#okgo").arcticmodal()}})}})});